{% extends 'base.html' %}
{% load static %}

{% block titulo %}{{ conteudo.titulo_pagina }} | Inteligência de Mercado{% endblock %}

{% block css_pagina %}
    <link rel="stylesheet" href="{% static 'gerenciamento_inteligencia_mercado/css/layout_inteligencia.css' %}">
{% endblock %}

{% block conteudo %}
<div class="container-conteudo-detalhe">
    
    <div class="cabecalho-detalhe-topo"> {# NOVO CONTAINER PARA O BOTÃO VOLTAR #}
        <a href="{% url 'inteligencia:lista_por_categoria' conteudo.categoria %}" class="botao-voltar-branco">
            <img src="{% static 'gerenciamento_inteligencia_mercado/icons/icone-voltar.svg' %}" alt="Ícone de seta">
            <span>Voltar para {{ conteudo.get_categoria_display }}</span>
        </a>
    </div>

    <div class="painel-conteudo-detalhe-branco">
        {# TÍTULO E SUBTÍTULO AGORA AQUI DENTRO, CENTRALIZADOS #}
        <h1 class="titulo-detalhe-card">{{ conteudo.titulo_pagina }}</h1>
        {% if conteudo.subtitulo_pagina %}
        <p class="subtitulo-detalhe-card">{{ conteudo.subtitulo_pagina }}</p>
        {% endif %}
        
        <hr class="separador-titulo-card-detalhe"> {# NOVO SEPARADOR DENTRO DO CARD #}

        <div class="corpo-artigo">
            {{ corpo_processado|safe }}
        </div>
    </div>
</div>
{% endblock %}

{% block js_pagina %}
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            // Encontra TODOS os containers de gráfico na página
            const chartContainers = document.querySelectorAll('.echarts-container');
            
            // Para cada container encontrado...
            chartContainers.forEach(function(container) {
                // Pega a configuração do gráfico do atributo 'data-options'
                const optionsJSON = container.dataset.options;
                
                if (optionsJSON) {
                    try {
                        // Converte a string JSON de volta para um objeto JavaScript
                        const options = JSON.parse(optionsJSON);
                        
                        // Inicializa o ECharts naquele container e desenha o gráfico
                        const chart = echarts.init(container);
                        chart.setOption(options);
                        
                        // Adiciona o redimensionamento automático
                        window.addEventListener('resize', function() {
                            chart.resize();
                        });
                    } catch (e) {
                        console.error('Erro ao processar as opções do gráfico:', e);
                    }
                }
            });
        });
    </script>
{% endblock %}