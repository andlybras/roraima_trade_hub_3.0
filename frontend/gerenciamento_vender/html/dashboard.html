{% extends 'base.html' %}
{% load static %}

{% block titulo %}Dashboard Empresarial{% endblock %}

{% block css_pagina %}
<link rel="stylesheet" href="{% static 'gerenciamento_vender/css/dashboard.css' %}">
{% endblock %}

{% block conteudo %}
<div class="container-conteudo">
    <div class="dashboard-container">
        <nav class="dashboard-nav">
            <div class="profile-section">
                <div class="profile-section">
                <img src="{% static 'gerenciamento_home/icons/user.svg' %}" alt="Foto do perfil" class="profile-picture">
                <span class="profile-name">{{ dados_empresa.nome_fantasia|default:request.user.email }}</span>
            </div>
            <hr class="nav-separator">
            <ul class="nav-list">
                <li class="nav-item"><a class="nav-link" data-url="{% url 'vender:dashboard_visao_geral' %}">Visão Geral</a></li>
                <li class="nav-item"><a class="nav-link" data-url="{% url 'vender:dashboard_dados_empresariais' %}">Dados Empresariais</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Raio-X Empresarial</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Vitrine</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Suporte e Consultoria</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Autenticação e Segurança</a></li>
                <li class="nav-item">
                    <form method="post" action="{% url 'vender:logout' %}" style="margin: 0;">
                        {% csrf_token %}
                        <button type="submit" class="nav-link" style="width: 100%; border: none; background: none; text-align: left; cursor: pointer; padding: 15px 20px;">
                            Sair
                        </button>
                    </form>
                </li>
            </ul>
        </nav>

        <main id="dashboard-content-area" class="dashboard-content">
            <p>Carregando...</p>
        </main>
    </div>
</div>
{% endblock %}

{% block js_pagina %}
<script>
// ... (O bloco de script permanece o mesmo da etapa anterior) ...
document.addEventListener('DOMContentLoaded', function() {
    const contentArea = document.getElementById('dashboard-content-area');
    const navLinks = document.querySelectorAll('.dashboard-nav .nav-link');

    function loadContent(url, setActiveLink = null) {
        contentArea.innerHTML = '<p>Carregando...</p>';
        fetch(url)
            .then(response => response.text())
            .then(html => {
                contentArea.innerHTML = html;
                if (setActiveLink) {
                    navLinks.forEach(l => l.classList.remove('active'));
                    setActiveLink.classList.add('active');
                }
            })
            .catch(error => {
                console.error('Erro ao carregar o conteúdo:', error);
                contentArea.innerHTML = '<p style="color: red;">Erro ao carregar o conteúdo. Tente novamente.</p>';
            });
    }

    navLinks.forEach(link => {
        link.addEventListener('click', function(event) {
            const url = this.dataset.url;
            if (url) {
                event.preventDefault();
                loadContent(url, this);
            }
        });
    });

    contentArea.addEventListener('click', function(event) {
        const link = event.target.closest('a.ajax-link');
        if (link) {
            event.preventDefault();
            loadContent(link.href);
        }
    });

    contentArea.addEventListener('submit', function(event) {
        const form = event.target.closest('#multi-step-form');
        if (form) {
            event.preventDefault();
            const formData = new FormData(form);
            contentArea.innerHTML = '<p>Salvando e avançando...</p>';
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: { 'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value },
            })
            .then(response => response.text())
            .then(html => {
                contentArea.innerHTML = html;
            })
            .catch(error => console.error('Erro ao enviar o formulário:', error));
        }
    });

    const initialLink = document.querySelector('.dashboard-nav .nav-link[data-url]');
    if (initialLink) {
        loadContent(initialLink.dataset.url, initialLink);
    }
});
</script>
{% endblock %}