{% extends 'base.html' %}
{% load static %}

{% block titulo %}Dashboard Empresarial{% endblock %}

{% block css_pagina %}
<link rel="stylesheet" href="{% static 'gerenciamento_vender/css/dashboard.css' %}">
{% endblock %}

{% block conteudo %}
<div class="container-conteudo">
    <div class="dashboard-container">
        <nav class="dashboard-nav">
            <div class="profile-section">
                <img src="{% static 'gerenciamento_home/icons/user.svg' %}" alt="Foto do perfil" class="profile-picture">
                <span class="profile-name">Nome da Empresa</span>
            </div>
            <hr class="nav-separator">
            <ul class="nav-list">
                <li class="nav-item"><a class="nav-link" data-url="{% url 'vender:dashboard_visao_geral' %}">Visão Geral</a></li>
                <li class="nav-item"><a class="nav-link" data-url="{% url 'vender:dashboard_dados_empresariais' %}">Dados Empresariais</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Raio-X Empresarial</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Vitrine</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Suporte e Consultoria</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Autenticação e Segurança</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Sair</a></li>
            </ul>
        </nav>

        <main id="dashboard-content-area" class="dashboard-content">
            <p>Carregando...</p>
        </main>
    </div>
</div>
{% endblock %}

{% block js_pagina %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const contentArea = document.getElementById('dashboard-content-area');
    const navLinks = document.querySelectorAll('.dashboard-nav .nav-link');

    // Função para carregar conteúdo via AJAX (GET)
    function loadContent(url, setActiveLink = null) {
        contentArea.innerHTML = '<p>Carregando...</p>';
        
        fetch(url)
            .then(response => response.text())
            .then(html => {
                contentArea.innerHTML = html;
                if (setActiveLink) {
                    navLinks.forEach(l => l.classList.remove('active'));
                    setActiveLink.classList.add('active');
                }
            })
            .catch(error => {
                console.error('Erro ao carregar o conteúdo:', error);
                contentArea.innerHTML = '<p style="color: red;">Erro ao carregar o conteúdo. Tente novamente.</p>';
            });
    }

    // Event listener para os links da navegação principal
    navLinks.forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            const url = this.dataset.url;
            if (url) {
                loadContent(url, this);
            }
        });
    });

    // Event Delegation: Observa a área de conteúdo para eventos
    contentArea.addEventListener('click', function(event) {
        const link = event.target.closest('a.ajax-link');
        if (link) {
            event.preventDefault();
            loadContent(link.href);
        }
    });

    contentArea.addEventListener('submit', function(event) {
        const form = event.target.closest('#multi-step-form');
        if (form) {
            event.preventDefault(); // Impede o recarregamento da página
            
            const formData = new FormData(form);
            contentArea.innerHTML = '<p>Salvando e avançando...</p>';

            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: { 'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value },
            })
            .then(response => response.text())
            .then(html => {
                contentArea.innerHTML = html; // Carrega a próxima etapa ou a página de sucesso
            })
            .catch(error => {
                console.error('Erro ao enviar o formulário:', error);
                contentArea.innerHTML = '<p style="color: red;">Erro ao enviar os dados. Tente novamente.</p>';
            });
        }
    });

    // Carrega a primeira aba ("Visão Geral") por padrão
    const initialLink = document.querySelector('.dashboard-nav .nav-link[data-url]');
    if (initialLink) {
        loadContent(initialLink.dataset.url, initialLink);
    }
});
</script>
{% endblock %}