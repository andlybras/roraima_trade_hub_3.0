{% extends 'base.html' %}
{% load static %}

{% block titulo %}{{ roteiro.titulo }} | Destino Roraima{% endblock %}

{% block css_pagina %}
<link rel="stylesheet" href="{% static 'gerenciamento_destino/css/destino_shared.css' %}">
<link rel="stylesheet" href="{% static 'gerenciamento_destino/css/roteiros.css' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
{% endblock %}

{% block conteudo %}
<div class="container-conteudo">
    {% include 'gerenciamento_destino/html/partials/breadcrumb.html' %}
    <div class="painel-detalhe-roteiro">

        <div class="print-header">
            <h1 class="print-title">{{ roteiro.titulo }}</h1>
        </div>

        <header class="roteiro-detalhe-cabecalho">
            <h1>{{ roteiro.titulo }}</h1>
            <div class="roteiro-acoes">
                <button onclick="window.print();" class="btn-imprimir-roteiro">Imprimir Roteiro</button>
            </div>
        </header>

        <section class="roteiro-detalhe-descricao">
            {{ roteiro.descricao|safe }}
        </section>

        <div class="roteiro-layout-principal">
            <div id="mapa-roteiro"></div>
            <section class="roteiro-paradas-lista">
                <h2>Pontos de Parada</h2>
                {% for ponto in pontos %}
                    <div class="parada-item">
                        <div class="parada-numero">{{ forloop.counter }}</div>
                        <div class="parada-conteudo">
                            <img src="{{ ponto.imagem_principal.url }}" alt="Imagem para {{ ponto.titulo }}" class="parada-imagem-print">
                            <h4>{{ ponto.titulo }}</h4>
                            <p>{{ ponto.descricao_curta }}</p>
                            <div class="parada-coordenadas-print">
                                <small>Latitude: {{ ponto.latitude }}</small><br>
                                <small>Longitude: {{ ponto.longitude }}</small>
                            </div>
                            <a href="{% url 'destino:detalhe_ponto' ponto.slug %}" class="parada-link-detalhes">Saber Mais &rarr;</a>
                        </div>
                    </div>
                {% endfor %}
            </section>
        </div>

        <div class="print-footer">
            Gerado por Roraima Trade Hub - www.roraimatradehub.com.br
        </div>
    </div>
</div>

{{ pontos_geojson|json_script:"pontos-data-roteiro" }}
{% endblock %}

{% block parceiros %}{% endblock parceiros %}

{% block js_pagina %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const pontosDataElement = document.getElementById('pontos-data-roteiro');
    if (!pontosDataElement) return;

    const pontosData = JSON.parse(pontosDataElement.textContent);
    if (pontosData.features.length === 0) return;

    const mapa = L.map('mapa-roteiro');
    setTimeout(function() { mapa.invalidateSize(); }, 100);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(mapa);

    const pontosLayer = L.geoJSON(pontosData, {
        onEachFeature: function(feature, layer) {
            // ATUALIZADO: Removido o link "Ver Detalhes"
            const props = feature.properties;
            let popupContent = `<b>${props.titulo}</b>`;
            layer.bindPopup(popupContent);
        }
    }).addTo(mapa);

    mapa.fitBounds(pontosLayer.getBounds(), { padding: [50, 50] });
});
</script>
{% endblock %}